module @basic;

const @test_failure = "test failure", 0;

function @assert_eq(2 => 0) {
    $scmp;
    global_addr @test_failure; panic_if cmp_ne;
    return;
}

function @test_empty(0 => 0) {
    return;
}

function @test_pop(0 => 0) {
    sint 42;
    sint 11;
    pop 2;
    return;
}

function @test_pick(0 => 0) {
    sint 42;
    sint 11;

    pick 0;
    sint 11; call @assert_eq;

    pick 1;
    sint 42; call @assert_eq;

    pop 2; return;
}

function @test_roll0(0 => 0) {
    sint 4;
    sint 3;
    sint 2;
    sint 1;
    sint 0;

    roll 0;

    sint 0; call @assert_eq;
    sint 1; call @assert_eq;
    sint 2; call @assert_eq;
    sint 3; call @assert_eq;
    sint 4; call @assert_eq;
    return;
}
function @test_roll1(0 => 0) {
    sint 4;
    sint 3;
    sint 2;
    sint 1;
    sint 0;

    roll 1;

    sint 1; call @assert_eq;
    sint 0; call @assert_eq;
    sint 2; call @assert_eq;
    sint 3; call @assert_eq;
    sint 4; call @assert_eq;
    return;
}
function @test_roll3(0 => 0) {
    sint 4;
    sint 3;
    sint 2;
    sint 1;
    sint 0;

    roll 3;

    sint 3; call @assert_eq;
    sint 0; call @assert_eq;
    sint 1; call @assert_eq;
    sint 2; call @assert_eq;
    sint 4; call @assert_eq;
    return;
}

function @test_drop0(0 => 0) {
    sint 4;
    sint 3;
    sint 2;
    sint 1;
    sint 0;

    drop 0;

    sint 1; call @assert_eq;
    sint 2; call @assert_eq;
    sint 3; call @assert_eq;
    sint 4; call @assert_eq;
    return;
}
function @test_drop1(0 => 0) {
    sint 4;
    sint 3;
    sint 2;
    sint 1;
    sint 0;

    drop 1;

    sint 0; call @assert_eq;
    sint 2; call @assert_eq;
    sint 3; call @assert_eq;
    sint 4; call @assert_eq;
    return;
}
function @test_drop3(0 => 0) {
    sint 4;
    sint 3;
    sint 2;
    sint 1;
    sint 0;

    drop 3;

    sint 0; call @assert_eq;
    sint 1; call @assert_eq;
    sint 2; call @assert_eq;
    sint 4; call @assert_eq;
    return;
}

function @test_select2(0 => 0) {
    sint 0;
    sint 42; sint 11;
    select 2; sint 11; call @assert_eq;

    sint 1;
    sint 42; sint 11;
    select 2; sint 42; call @assert_eq;

    return;
}
function @test_select3(0 => 0) {
    sint 0;
    sint 42; sint 11; sint 13;
    select 3; sint 13; call @assert_eq;

    sint 1;
    sint 42; sint 11; sint 13;
    select 3; sint 11; call @assert_eq;

    sint 2;
    sint 42; sint 11; sint 13;
    select 3; sint 42; call @assert_eq;

    return;
}

function @test_select_if_true(0 => 0) {
    sint 0;
    sint 42; sint 11;
    select_if is_true; sint 11; call @assert_eq;

    sint 1;
    sint 42; sint 11;
    select_if is_true; sint 42; call @assert_eq;

    return;
}
function @test_select_if_false(0 => 0) {
    sint 0;
    sint 42; sint 11;
    select_if is_false; sint 42; call @assert_eq;

    sint 1;
    sint 42; sint 11;
    select_if is_false; sint 11; call @assert_eq;

    return;
}

function @test_panic(0 => 0) {
    global_addr @test_failure; panic;
}
function @test_panic_if(0 => 0) {
    sint 0; global_addr @test_failure; panic_if is_false;
}

