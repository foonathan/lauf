module @basic;

const @test_failure = "test failure", 0;

function @assert_eq(2 => 0) {
    call_builtin @scmp;
    global_addr @test_failure; panic_if cmp_ne;
    return;
}

function @test_empty(0 => 0) {
    return;
}

function @test_drop(0 => 0) {
    int 42;
    int 11;
    drop 2;
    return;
}

function @test_pick(0 => 0) {
    int 42;
    int 11;

    pick 0;
    int 11; call @assert_eq;

    pick 1;
    int 42; call @assert_eq;

    drop 2; return;
}

function @test_roll0(0 => 0) {
    int 4;
    int 3;
    int 2;
    int 1;
    int 0;

    roll 0;

    int 0; call @assert_eq;
    int 1; call @assert_eq;
    int 2; call @assert_eq;
    int 3; call @assert_eq;
    int 4; call @assert_eq;
    return;
}
function @test_roll1(0 => 0) {
    int 4;
    int 3;
    int 2;
    int 1;
    int 0;

    roll 1;

    int 1; call @assert_eq;
    int 0; call @assert_eq;
    int 2; call @assert_eq;
    int 3; call @assert_eq;
    int 4; call @assert_eq;
    return;
}
function @test_roll3(0 => 0) {
    int 4;
    int 3;
    int 2;
    int 1;
    int 0;

    roll 3;

    int 3; call @assert_eq;
    int 0; call @assert_eq;
    int 1; call @assert_eq;
    int 2; call @assert_eq;
    int 4; call @assert_eq;
    return;
}

function @test_select2(0 => 0) {
    int 0;
    int 42; int 11;
    select 2; int 11; call @assert_eq;

    int 1;
    int 42; int 11;
    select 2; int 42; call @assert_eq;

    return;
}
function @test_select3(0 => 0) {
    int 0;
    int 42; int 11; int 13;
    select 3; int 13; call @assert_eq;

    int 1;
    int 42; int 11; int 13;
    select 3; int 11; call @assert_eq;

    int 2;
    int 42; int 11; int 13;
    select 3; int 42; call @assert_eq;

    return;
}

function @test_select_if_true(0 => 0) {
    int 0;
    int 42; int 11;
    select_if is_true; int 11; call @assert_eq;

    int 1;
    int 42; int 11;
    select_if is_true; int 42; call @assert_eq;

    return;
}
function @test_select_if_false(0 => 0) {
    int 0;
    int 42; int 11;
    select_if is_false; int 42; call @assert_eq;

    int 1;
    int 42; int 11;
    select_if is_false; int 11; call @assert_eq;

    return;
}
